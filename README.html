<h1 id="simple-conjoint-analyses-and-visualization">Simple Conjoint Analyses and Visualization</h1>
<p><strong>cregg</strong> is a package for analyzing and visualizing the results of conjoint (&quot;cj&quot;) factorial experiments. It provides functionality that is useful for analyzing and otherwise examining conjoint experimental data:</p>
<ul>
<li>Estimation of average marginal component effects (AMCEs) for fully randomized conjoint designs and munging of AMCE estimates into tidy data frames, via <code>amce()</code></li>
<li>Calculation of marginal means (MMs) for conjoint designs and munging them into tidy data frames via <code>mm()</code></li>
<li>Tabulation of display frequencies of feature attributes via <code>freqs()</code></li>
<li><strong>ggplot2</strong>-based visualizations of AMCEs and MMs, via <code>plot()</code> methods for all of the above</li>
</ul>
<p>The package takes its name from the surname of a famous White House Press Secretary.</p>
<p>The main selling point of cregg is simplicity of implementation and - unlike the <a href="https://cran.r-project.org/package=cjoint">cjoint</a> package - cregg tries to follow tidy data principles throughout. Thus the response from both <code>mm()</code> and <code>cj()</code> consists of tidy data frames that can easily be stacked with others (e.g., for computing AMCEs for subsets of respondents and then producing a facetted or grouped visualization). It also tries to take better advantage of data preprocessing steps by:</p>
<ul>
<li>Using factor base levels rather than trying to set baseline levels atomically</li>
<li>Using &quot;label&quot; attributes on variables to provide pretty printing</li>
</ul>
<p>Additionally all functions have arguments in data-formula order, making it simple to pipe into them via <code>%&gt;%</code>.</p>
<p>Contributions and feedback are welcome on <a href="https://github.com/leeper/cregg/issues">GitHub</a>.</p>
<h2 id="code-examples">Code Examples</h2>
<p>The package includes an example conjoint dataset (borrowed and lightly modified from the <a href="https://cran.r-project.org/package=cjoint">cjoint</a> package), which is used here and and in examples:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;cregg&quot;</span>)
<span class="kw">data</span>(<span class="st">&quot;hainmueller&quot;</span>)</code></pre></div>
<p>The package provides straightforward calculation and visualization of descriptive marginal means (MMs). These represent the mean outcome across all appearances of a particular conjoint feature level, averaging across all other features. In forced choice conjoint designs, MMs by definition average 0.5 with values above 0.5 indicating features that increase profile favorability and values below 0.5 indicating features that decrease profile favorability. For continuous outcomes, AMMs can take any value in the full range of the outcome. Calculation of MMs entail no modelling assumptions are simply descriptive quantities of interest:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># descriptive plotting</span>
f1 &lt;-<span class="st"> </span>ChosenImmigrant <span class="op">~</span><span class="st"> </span>Gender <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>LanguageSkills <span class="op">+</span><span class="st"> </span>CountryOfOrigin <span class="op">+</span><span class="st"> </span>Job <span class="op">+</span><span class="st"> </span>JobExperience <span class="op">+</span><span class="st"> </span>JobPlans <span class="op">+</span><span class="st"> </span>ReasonForApplication <span class="op">+</span><span class="st"> </span>
<span class="st">    </span>PriorEntry
<span class="kw">plot</span>(<span class="kw">mm</span>(hainmueller, f1, <span class="dt">id =</span> <span class="op">~</span>CaseID), <span class="dt">vline =</span> <span class="fl">0.5</span>)</code></pre></div>
<div class="figure">
<img src="figure/mmplot-1.png" alt="plot of chunk mmplot" />
<p class="caption">plot of chunk mmplot</p>
</div>
<p>cregg functions uses <code>attributes(feature)$label</code> to provide pretty printing of feature labels, so that varible names can be arbitrary. These can be overwritten using the <code>feature_labels</code> argument to override these settings. Feature levels are always deduced from the <code>levels()</code> of righthand-side variables in the model specification. All variables should be factors with levels in desired display order. Similarly, the plotted order of features is given by the order of terms in the RHS formula unless overridden by the order of variable names given in <code>feature_order</code>.</p>
<p>A more common analytic approach for conjoints is to estimate average marginal component effects (AMCEs) using some form of regression analysis. cregg uses <code>glm()</code> and <code>svyglm()</code> to perform estimation and <a href="https://cran.r-project.org/package=margins">margins</a> to generate average marginal effect estimates. Designs can be specified with any interactions between conjoint features but only AMCEs are returned. (No functionality is provided at the moment for explict estimation of feature interaction effects.) Just like for <code>amm()</code>, the output of <code>cj()</code> (or its alias, <code>amce()</code>) is a tidy data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimation</span>
f2 &lt;-<span class="st"> </span>ChosenImmigrant <span class="op">~</span><span class="st"> </span>Gender <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>LanguageSkills <span class="op">+</span><span class="st"> </span>CountryOfOrigin
amces &lt;-<span class="st"> </span><span class="kw">cj</span>(hainmueller, f2, <span class="dt">id =</span> <span class="op">~</span>CaseID)
<span class="kw">str</span>(amces)</code></pre></div>
<pre><code>Classes &#39;cj_amce&#39; and &#39;data.frame&#39;: 23 obs. of  9 variables:
 $ outcome  : chr  &quot;ChosenImmigrant&quot; &quot;ChosenImmigrant&quot; &quot;ChosenImmigrant&quot; &quot;ChosenImmigrant&quot; ...
 $ feature  : Factor w/ 4 levels &quot;Gender&quot;,&quot;Educational Attainment&quot;,..: 1 1 2 2 2 2 2 2 2 3 ...
 $ level    : Factor w/ 23 levels &quot;Female&quot;,&quot;Male&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
 $ estimate : num  0 -0.0273 0 0.0323 0.0591 ...
 $ std.error: Named num  NA 0.00831 NA 0.01534 0.0154 ...
  ..- attr(*, &quot;names&quot;)= chr  NA &quot;Var_dydx_GenderMale&quot; NA &quot;Var_dydx_Education4th Grade&quot; ...
 $ z        : num  NA -3.28 NA 2.11 3.84 ...
 $ p        : num  NA 0.001036 NA 0.035009 0.000125 ...
 $ lower    : num  NA -0.04355 NA 0.00227 0.02891 ...
 $ upper    : num  NA -0.011 NA 0.0624 0.0893 ...</code></pre>
<p>This makes it very easy to modify, combine, print, etc. the resulting output. It also makes it easy to visualize using ggplot2. A convenience visualization function is provided:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plotting of AMCEs</span>
<span class="kw">plot</span>(amces)</code></pre></div>
<div class="figure">
<img src="figure/plot_amce-1.png" alt="plot of chunk plot_amce" />
<p class="caption">plot of chunk plot_amce</p>
</div>
<p>The package also provide a useful function for checking display frequencies of conjoint features (to ensure equal - or unequal - display frequency):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plotting of display frequencies</span>
<span class="kw">plot</span>(<span class="kw">freqs</span>(hainmueller, f1, <span class="dt">id =</span> <span class="op">~</span>CaseID))</code></pre></div>
<div class="figure">
<img src="figure/plot_freqs-1.png" alt="plot of chunk plot_freqs" />
<p class="caption">plot of chunk plot_freqs</p>
</div>
<p>As can be clear in the above, constraints were imposed in the original study on the allowed combinations of <code>Job</code> and <code>Education</code> and also on combinations of <code>CountryOfOrigin</code> and <code>ReasonForApplication</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(hainmueller<span class="op">$</span>Job, hainmueller<span class="op">$</span>Education)</code></pre></div>
<pre><code>                     
                      No Formal 4th Grade 8th Grade High School Two-Year College College Degree Graduate Degree
  Janitor                   290       270       299         240              182            190             162
  Waiter                    275       282       301         283              171            202             208
  Child Care Provider       288       324       286         315              200            172             171
  Gardener                  257       275       284         284              172            189             191
  Financial Analyst           0         0         0           0              171            154             162
  Construction Worker       281       283       250         289              181            183             191
  Teacher                   275       288       282         287              201            168             188
  Computer Programmer         0         0         0           0              169            196             177
  Nurse                     298       296       296         296              197            178             170
  Research Scientist          0         0         0           0              176            169             195
  Doctor                      0         0         0           0              185            162             203</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(hainmueller<span class="op">$</span>CountryOfOrigin, hainmueller<span class="op">$</span>ReasonForApplication)</code></pre></div>
<pre><code>             
              Reunite with Family Seek Better Job Escape Persecution
  India                       695             706                  0
  Germany                     704             719                  0
  France                      704             738                  0
  Mexico                      690             674                  0
  Philippines                 710             682                  0
  Poland                      707             694                  0
  China                       438             485                494
  Sudan                       427             482                484
  Somalia                     465             463                475
  Iraq                        442             436                446</code></pre>
<h2 id="installation">Installation</h2>
<p><a href="https://cran.r-project.org/package=cregg"><img src="https://www.r-pkg.org/badges/version/cregg" alt="CRAN" /></a> <img src="https://cranlogs.r-pkg.org/badges/cregg" alt="Downloads" /> <a href="https://travis-ci.org/leeper/cregg"><img src="https://travis-ci.org/leeper/cregg.png?branch=master" alt="Travis Build Status" /></a> <a href="https://ci.appveyor.com/project/leeper/cregg"><img src="https://ci.appveyor.com/api/projects/status/PROJECTNUMBER?svg=true" alt="Appveyor Build Status" /></a> <a href="https://codecov.io/github/leeper/cregg?branch=master"><img src="https://codecov.io/github/leeper/cregg/coverage.svg?branch=master" alt="codecov.io" /></a></p>
<p>This package is not yet on CRAN. To install the latest development version you can pull a potentially unstable version directly from GitHub:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">&quot;ghit&quot;</span>)) {
    <span class="kw">install.packages</span>(<span class="st">&quot;ghit&quot;</span>)
}
ghit<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;leeper/cregg&quot;</span>)</code></pre></div>
