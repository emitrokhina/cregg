<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Preference Heterogeneity Diagnostics — amce_diffs • cregg</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Preference Heterogeneity Diagnostics — amce_diffs" />

<meta property="og:description" content="Tests for preference heterogeneity in conjoint experiments" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cregg</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Introduction.html">Introduction to cregg</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leeper/cregg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Preference Heterogeneity Diagnostics</h1>
    <small class="dont-index">Source: <a href='https://github.com/leeper/cregg/blob/master/R/amce_diffs.R'><code>R/amce_diffs.R</code></a>, <a href='https://github.com/leeper/cregg/blob/master/R/cj_anova.R'><code>R/cj_anova.R</code></a>, <a href='https://github.com/leeper/cregg/blob/master/R/mm_diffs.R'><code>R/mm_diffs.R</code></a></small>
    <div class="hidden name"><code>diffs.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Tests for preference heterogeneity in conjoint experiments</p>
    
    </div>

    <pre class="usage"><span class='fu'>amce_diffs</span>(<span class='no'>data</span>, <span class='no'>formula</span>, <span class='no'>by</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>feature_order</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>feature_labels</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>level_order</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"ascending"</span>, <span class='st'>"descending"</span>), <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.05</span>, <span class='no'>...</span>)

<span class='fu'>cj_anova</span>(<span class='no'>data</span>, <span class='no'>formula</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>mm_diffs</span>(<span class='no'>data</span>, <span class='no'>formula</span>, <span class='no'>by</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>feature_order</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>feature_labels</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>level_order</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"ascending"</span>, <span class='st'>"descending"</span>), <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.05</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data frame containing variables specified in <code>formula</code>. All RHS variables should be factors; the base level for each will be used in estimation and for AMCEs the base level's AMCE will be NA. Optionally, this can instead be an object of class &#8220;survey.design&#8221; returned by <code><a href='http://www.rdocumentation.org/packages/survey/topics/svydesign'>svydesign</a></code>.</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>A formula specifying a model to be estimated. All variables should be factors.</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>A formula containing only RHS variables, specifying grouping factors over which to perform estimation. For <code>amce_diffs</code>, this can be a factor or something coercable to factor. For <code>mm_diffs</code> the variable must only take two levels.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>Ignored.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>An (optional) RHS formula specifying a variable holding survey weights.</p></td>
    </tr>
    <tr>
      <th>feature_order</th>
      <td><p>An (optional) character vector specifying the names of feature (RHS) variables in the order they should be encoded in the resulting data frame.</p></td>
    </tr>
    <tr>
      <th>feature_labels</th>
      <td><p>A named list of &#8220;fancy&#8221; feature labels to be used in output. By default, the function looks for a &#8220;label&#8221; attribute on each variable in <code>formula</code> and uses that for pretty printing. This argument overrides those attributes or otherwise provides fancy labels for this purpose. This should be a list with names equal to variables on the righthand side of <code>formula</code> and character string values; arguments passed here override variable attributes.</p></td>
    </tr>
    <tr>
      <th>level_order</th>
      <td><p>A character string specifying levels (within each feature) should be ordered increasing or decreasing in the final output. This is mostly only consequential for plotting via <code>plot.cj_mm</code>, etc.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>A numeric value indicating the significance level at which to calculate confidence intervals for the MMs (by default 0.95, meaning 95-percent CIs are returned).</p></td>
    </tr>
    <tr>
      <th>&#8230;</th>
      <td><p>Additional arguments to <code><a href='amce.html'>amce</a></code>, <code><a href='freqs.html'>freqs</a></code>, or <code><a href='mm.html'>mm</a></code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>amce_diffs</code> and <code>mm_diffs</code> return a data frame similar to the one returned by <code>cj</code>, including a <code>BY</code> column (with the value &#8220;Difference&#8221;) for easy merging with results returned by that function.</p>
<p><code>cj_anova</code> returns an <code><a href='http://www.rdocumentation.org/packages/stats/topics/anova'>anova</a></code> object.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>cj_anova</code> takes a model formula (&#8220;reduced&#8221; model) and generates a &#8220;full&#8221; model with two-way interactions between the variables specified in <code>by</code> and all RHS variables in <code>formula</code>, then computes an F-test comparing the two models, providing a test for whether preferences vary across levels of <code>by</code>. This is, in essence, a test of whether all such interaction coefficients are distinguishable from zero. (Because the test depends on overall model fit, not the coefficient variances, clustering is irrelevant.)</p>
<p><code>mm_diffs</code> provides a data frame of differences in marginal means (literally differencing the results from <code><a href='mm.html'>mm</a></code> across levels of <code>by</code>. This provides the clearest direct measure of preference differences from a conjoint design.</p>
<p><code>amce_diffs</code> provides a data frame of differences in AMCEs (the coefficient on an interaction between each RHS factor and the variable in <code>by</code>). This provides an estimate of the difference in causal effects of each factor level relative to the baseline level (i.e., the difference in conditional AMCEs). This quantity is easily misinterpreted as the difference in preferences, which it is not. Rather it is a difference in the effect of the factor on preferences relative to the baseline/reference category of that feature. If preferences in the reference category differ across levels of <code>by</code>, the the difference in conditional AMCEs will have an unpredictable sign and significance, making differences in marginal means a more sensible quantity of interest. See <code><a href='amce.html'>amce_by_reference</a></code> for a diagnostic.</p>
<p>Note: <code>amce_diffs</code> does not work with constrained designs. To obtain such differences, subset the design by constraints and calculate differences within each subset.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='amce.html'>amce</a></code> <code><a href='mm.html'>mm</a></code> <code><a href='freqs.html'>freqs</a></code> <code><a href='plot.html'>plot.cj_amce</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>data</span>(<span class='st'>"immigration"</span>)
<span class='co'># Test for heterogeneity by profile order</span>
<span class='fu'>cj_anova</span>(<span class='no'>immigration</span>, <span class='no'>ChosenImmigrant</span> ~ <span class='no'>Gender</span> + <span class='no'>Education</span> + <span class='no'>LanguageSkills</span>, <span class='kw'>by</span> <span class='kw'>=</span> ~ <span class='no'>contest_no</span>)</div><div class='output co'>#&gt; Analysis of Deviance Table
#&gt; 
#&gt; Model 1: ChosenImmigrant ~ Gender + Education + LanguageSkills
#&gt; Model 2: ChosenImmigrant ~ Gender + Education + LanguageSkills + contest_no + 
#&gt;     Gender:contest_no + Education:contest_no + LanguageSkills:contest_no
#&gt;   Resid. Df Resid. Dev Df Deviance      F Pr(&gt;F)
#&gt; 1     13949     3353.0                          
#&gt; 2     13938     3349.6 11   3.3873 1.2814 0.2279</div><div class='input'>
<span class='co'># Test for heterogeneity by CountryOfOrigin feature</span>
<span class='fu'>cj_anova</span>(<span class='no'>immigration</span>, <span class='no'>ChosenImmigrant</span> ~ <span class='no'>Gender</span> + <span class='no'>Education</span>, <span class='kw'>by</span> <span class='kw'>=</span> ~ <span class='no'>CountryOfOrigin</span>)</div><div class='output co'>#&gt; Analysis of Deviance Table
#&gt; 
#&gt; Model 1: ChosenImmigrant ~ Gender + Education
#&gt; Model 2: ChosenImmigrant ~ Gender + Education + CountryOfOrigin + Gender:CountryOfOrigin + 
#&gt;     Education:CountryOfOrigin
#&gt;   Resid. Df Resid. Dev Df Deviance      F    Pr(&gt;F)    
#&gt; 1     13952     3407.8                                 
#&gt; 2     13880     3374.5 72   33.286 1.9016 6.756e-06 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</div><div class='input'>
</div><span class='co'># NOT RUN {</span>
<span class='co'># Differences in MMs by Gender feature</span>
<span class='fu'>mm_diffs</span>(<span class='no'>immigration</span>, <span class='no'>ChosenImmigrant</span> ~ <span class='no'>LanguageSkills</span> + <span class='no'>Education</span>, ~ <span class='no'>Gender</span>, <span class='kw'>id</span> <span class='kw'>=</span> ~ <span class='no'>CaseID</span>)

<span class='co'># Differences in AMCEs by Gender feature (i.e., feature interactions)</span>
<span class='fu'>amce_diffs</span>(<span class='no'>immigration</span>, <span class='no'>ChosenImmigrant</span> ~ <span class='no'>LanguageSkills</span> + <span class='no'>Education</span>, ~ <span class='no'>Gender</span>, <span class='kw'>id</span> <span class='kw'>=</span> ~ <span class='no'>CaseID</span>)
<span class='co'># }</span><div class='input'>
<span class='co'># preferences differ for Male and Female immigrants with 'Broken English' ability</span>
(<span class='no'>m1</span> <span class='kw'>&lt;-</span> <span class='fu'>mm_diffs</span>(<span class='no'>immigration</span>, <span class='no'>ChosenImmigrant</span> ~ <span class='no'>LanguageSkills</span>, ~ <span class='no'>Gender</span>, <span class='kw'>id</span> <span class='kw'>=</span> ~ <span class='no'>CaseID</span>))</div><div class='output co'>#&gt;              BY     statistic         outcome         feature
#&gt; 1 Male - Female mm_difference ChosenImmigrant Language Skills
#&gt; 2 Male - Female mm_difference ChosenImmigrant Language Skills
#&gt; 3 Male - Female mm_difference ChosenImmigrant Language Skills
#&gt; 4 Male - Female mm_difference ChosenImmigrant Language Skills
#&gt;                      level     estimate  std.error          z          p
#&gt; 1           Fluent English -0.015436300 0.01646401 -0.9375783 0.34846119
#&gt; 2           Broken English -0.047683617 0.01701027 -2.8032247 0.00505944
#&gt; 3 Tried English but Unable -0.009770039 0.01685683 -0.5795893 0.56219159
#&gt; 4         Used Interpreter -0.030670893 0.01684262 -1.8210283 0.06860255
#&gt;         lower        upper Gender
#&gt; 1 -0.04251719  0.011644591   Male
#&gt; 2 -0.07566303 -0.019704208   Male
#&gt; 3 -0.03749706  0.017956979   Male
#&gt; 4 -0.05837454 -0.002967244   Male</div><div class='input'>
<span class='co'># yet differences in conditional AMCEs  depend on the reference category</span>
<span class='fu'>amce_diffs</span>(<span class='no'>immigration</span>, <span class='no'>ChosenImmigrant</span> ~ <span class='no'>LanguageSkills</span>, ~ <span class='no'>Gender</span>, <span class='kw'>id</span> <span class='kw'>=</span> ~ <span class='no'>CaseID</span>)</div><div class='output co'>#&gt;              BY         outcome       statistic         feature
#&gt; 1 Male - Female ChosenImmigrant amce_difference Language Skills
#&gt; 2 Male - Female ChosenImmigrant amce_difference Language Skills
#&gt; 3 Male - Female ChosenImmigrant amce_difference Language Skills
#&gt;                      level Gender     estimate  std.error          z         p
#&gt; 1           Broken English   Male -0.032247317 0.02366186 -1.3628393 0.1729332
#&gt; 2 Tried English but Unable   Male  0.005666262 0.02313999  0.2448688 0.8065580
#&gt; 3         Used Interpreter   Male -0.015234592 0.02388354 -0.6378698 0.5235584
#&gt;         lower      upper
#&gt; 1 -0.07862372 0.01412908
#&gt; 2 -0.03968728 0.05101980
#&gt; 3 -0.06204548 0.03157629</div><div class='input'><span class='no'>immigration</span>$<span class='no'>LanguageSkills2</span> <span class='kw'>&lt;-</span> <span class='fu'>relevel</span>(<span class='no'>immigration</span>$<span class='no'>LanguageSkills</span>, <span class='st'>"Used Interpreter"</span>)
<span class='fu'>amce_diffs</span>(<span class='no'>immigration</span>, <span class='no'>ChosenImmigrant</span> ~ <span class='no'>LanguageSkills2</span>, ~ <span class='no'>Gender</span>, <span class='kw'>id</span> <span class='kw'>=</span> ~ <span class='no'>CaseID</span>)</div><div class='output co'>#&gt;              BY         outcome       statistic         feature
#&gt; 1 Male - Female ChosenImmigrant amce_difference LanguageSkills2
#&gt; 2 Male - Female ChosenImmigrant amce_difference LanguageSkills2
#&gt; 3 Male - Female ChosenImmigrant amce_difference LanguageSkills2
#&gt;                      level Gender    estimate  std.error          z         p
#&gt; 1           Broken English   Male -0.01701272 0.02372866 -0.7169694 0.4733930
#&gt; 2           Fluent English   Male  0.01523459 0.02388354  0.6378698 0.5235584
#&gt; 3 Tried English but Unable   Male  0.02090085 0.02366212  0.8833043 0.3770719
#&gt;         lower      upper
#&gt; 1 -0.06352005 0.02949460
#&gt; 2 -0.03157629 0.06204548
#&gt; 3 -0.02547605 0.06727776</div><div class='input'>
<span class='co'># while differences in MMs do not depend on the reference cateory</span>
(<span class='no'>m2</span> <span class='kw'>&lt;-</span> <span class='fu'>mm_diffs</span>(<span class='no'>immigration</span>, <span class='no'>ChosenImmigrant</span> ~ <span class='no'>LanguageSkills2</span>, ~ <span class='no'>Gender</span>, <span class='kw'>id</span> <span class='kw'>=</span> ~ <span class='no'>CaseID</span>))</div><div class='output co'>#&gt;              BY     statistic         outcome         feature
#&gt; 1 Male - Female mm_difference ChosenImmigrant LanguageSkills2
#&gt; 2 Male - Female mm_difference ChosenImmigrant LanguageSkills2
#&gt; 3 Male - Female mm_difference ChosenImmigrant LanguageSkills2
#&gt; 4 Male - Female mm_difference ChosenImmigrant LanguageSkills2
#&gt;                      level     estimate  std.error          z          p
#&gt; 1         Used Interpreter -0.030670893 0.01684262 -1.8210283 0.06860255
#&gt; 2           Fluent English -0.015436300 0.01646401 -0.9375783 0.34846119
#&gt; 3           Broken English -0.047683617 0.01701027 -2.8032247 0.00505944
#&gt; 4 Tried English but Unable -0.009770039 0.01685683 -0.5795893 0.56219159
#&gt;         lower        upper Gender
#&gt; 1 -0.05837454 -0.002967244   Male
#&gt; 2 -0.04251719  0.011644591   Male
#&gt; 3 -0.07566303 -0.019704208   Male
#&gt; 4 -0.03749706  0.017956979   Male</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Thomas J. Leeper &lt;thosjleeper@gmail.com&gt;

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Thomas J. Leeper.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

