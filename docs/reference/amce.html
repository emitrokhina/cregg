<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Tidy estimation of AMCEs — amce • cregg</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Tidy estimation of AMCEs — amce" />

<meta property="og:description" content="Estimate AMCEs for a conjoint analysis and return a tidy data frame of results" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cregg</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Introduction.html">Introduction to cregg</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leeper/cregg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Tidy estimation of AMCEs</h1>
    <small class="dont-index">Source: <a href='https://github.com/leeper/cregg/blob/master/R/amce.R'><code>R/amce.R</code></a></small>
    <div class="hidden name"><code>amce.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Estimate AMCEs for a conjoint analysis and return a tidy data frame of results</p>
    
    </div>

    <pre class="usage"><span class='fu'>amce</span>(<span class='no'>data</span>, <span class='no'>formula</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>feature_order</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>feature_labels</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>level_order</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"ascending"</span>, <span class='st'>"descending"</span>),
  <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.05</span>, <span class='no'>...</span>)

<span class='fu'>amce_by_reference</span>(<span class='no'>data</span>, <span class='no'>formula</span>, <span class='no'>variable</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data frame containing variables specified in <code>formula</code>. All RHS variables should be factors; the base level for each will be used in estimation and its reported AMCE will be NA (for printing). Optionally, this can instead be an object of class &#8220;survey.design&#8221; returned by <code><a href='http://www.rdocumentation.org/packages/survey/topics/svydesign'>svydesign</a></code>.</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>A formula specifying an AMCE model to be estimated. All variables should be factors. Two-way interactions can be specified to handle constraints between factors in the design. These are detected automatically. Higher-order constraints are not allowed.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>An RHS formula specifying a variable holding respondent identifiers, to be used for clustering standard errors.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>An (optional) RHS formula specifying a variable holding survey weights.</p></td>
    </tr>
    <tr>
      <th>feature_order</th>
      <td><p>An (optional) character vector specifying the names of feature (RHS) variables in the order they should be encoded in the resulting data frame.</p></td>
    </tr>
    <tr>
      <th>feature_labels</th>
      <td><p>A named list of &#8220;fancy&#8221; feature labels to be used in output. By default, the function looks for a &#8220;label&#8221; attribute on each variable in <code>formula</code> and uses that for pretty printing. This argument overrides those attributes or otherwise provides fancy labels for this purpose. This should be a list with names equal to variables on the righthand side of <code>formula</code> and character string values; arguments passed here override variable attributes.</p></td>
    </tr>
    <tr>
      <th>level_order</th>
      <td><p>A character string specifying levels (within each feature) should be ordered increasing or decreasing in the final output. This is mostly only consequential for plotting via <code>plot.cj_mm</code>, etc.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>A numeric value indicating the significance level at which to calculate confidence intervals for the MMs (by default 0.95, meaning 95-percent CIs are returned).</p></td>
    </tr>
    <tr>
      <th>&#8230;</th>
      <td><p>For <code>amce</code>: additional arguments to <code><a href='http://www.rdocumentation.org/packages/stats/topics/glm'>glm</a></code> or <code><a href='http://www.rdocumentation.org/packages/survey/topics/svyglm'>svyglm</a></code>, the latter being used if <code>weights</code> is non-NULL. For <code>amce_by_reference</code>: additional arguments passed to <code>amce</code>.</p></td>
    </tr>
    <tr>
      <th>variable</th>
      <td><p>An RHS formula containing a single factor variable from <code>formula</code>. This will be used by <code>amce_by_reference</code> to estimate AMCEs relative to each possible factor level as a reference category. If more than one RHS variables are specified, the first will be used.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>amce</code> provides estimates of AMCEs (or rather, average marginal effects for each feature level). It does not calculate AMCEs for constrained conjoint designs. The function can also be used for balance testing by specifying a covariate rather outcome on the left-hand side of <code>formula</code>. See examples.</p>
<p><code>amce_by_reference</code> provides a tool for quick sensitivity analysis. AMCEs are defined relative to an arbitrary reference category (i.e., feature level). This function will loop over all feature levels (for a specified feature) to show how interpretation will be affected by choice of reference category. The resulting data frame will be a stacked result from <code>amce</code>, containing an additional <code>.reference</code> column specifying which level of <code>variable</code> was used as the reference category.</p>
<p>Users may desire to specify a <code>family</code> argument via <code>&#8230;</code>, which should be a &#8220;family&#8221; object such as <code>gaussian</code>. Sensible alternatives are <code>binomial</code> (for binary outcomes) and quasibinomial (for weighted survey data). See <code><a href='http://www.rdocumentation.org/packages/stats/topics/family'>family</a></code> for details.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='diffs.html'>amce_diffs</a></code> <code><a href='mm.html'>mm</a></code> <code><a href='plot.html'>plot.cj_amce</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>data</span>(<span class='st'>"taxes"</span>)
<span class='co'># estimating AMCEs</span>
<span class='fu'>amce</span>(<span class='no'>taxes</span>, <span class='no'>chose_plan</span> ~ <span class='no'>taxrate1</span> + <span class='no'>taxrate2</span> + <span class='no'>taxrate3</span> +
     <span class='no'>taxrate4</span> + <span class='no'>taxrate5</span> + <span class='no'>taxrate6</span> + <span class='no'>taxrev</span>, <span class='kw'>id</span> <span class='kw'>=</span> ~ <span class='no'>ID</span>)</div><div class='output co'>#&gt;       outcome statistic                        feature         level
#&gt; 1  chose_plan      amce          Tax rate for &lt;$10,000      &lt;10k: 0%
#&gt; 2  chose_plan      amce          Tax rate for &lt;$10,000      &lt;10k: 5%
#&gt; 3  chose_plan      amce          Tax rate for &lt;$10,000     &lt;10k: 15%
#&gt; 4  chose_plan      amce          Tax rate for &lt;$10,000     &lt;10k: 25%
#&gt; 5  chose_plan      amce   Tax rate for $10,000-$35,000    10-35k: 5%
#&gt; 6  chose_plan      amce   Tax rate for $10,000-$35,000   10-35k: 15%
#&gt; 7  chose_plan      amce   Tax rate for $10,000-$35,000   10-35k: 25%
#&gt; 8  chose_plan      amce   Tax rate for $10,000-$35,000   10-35k: 35%
#&gt; 9  chose_plan      amce   Tax rate for $25,000-$85,000    35-85k: 5%
#&gt; 10 chose_plan      amce   Tax rate for $25,000-$85,000   35-85k: 15%
#&gt; 11 chose_plan      amce   Tax rate for $25,000-$85,000   35-85k: 25%
#&gt; 12 chose_plan      amce   Tax rate for $25,000-$85,000   35-85k: 35%
#&gt; 13 chose_plan      amce  Tax rate for $85,000-$175,000   85-175k: 5%
#&gt; 14 chose_plan      amce  Tax rate for $85,000-$175,000  85-175k: 15%
#&gt; 15 chose_plan      amce  Tax rate for $85,000-$175,000  85-175k: 25%
#&gt; 16 chose_plan      amce  Tax rate for $85,000-$175,000  85-175k: 35%
#&gt; 17 chose_plan      amce Tax rate for $175,000-$375,000  175-375k: 5%
#&gt; 18 chose_plan      amce Tax rate for $175,000-$375,000 175-375k: 15%
#&gt; 19 chose_plan      amce Tax rate for $175,000-$375,000 175-375k: 25%
#&gt; 20 chose_plan      amce Tax rate for $175,000-$375,000 175-375k: 35%
#&gt; 21 chose_plan      amce Tax rate for $175,000-$375,000 175-375k: 45%
#&gt; 22 chose_plan      amce         Tax rate for &gt;$375,000     &gt;375k: 5%
#&gt; 23 chose_plan      amce         Tax rate for &gt;$375,000    &gt;375k: 15%
#&gt; 24 chose_plan      amce         Tax rate for &gt;$375,000    &gt;375k: 25%
#&gt; 25 chose_plan      amce         Tax rate for &gt;$375,000    &gt;375k: 35%
#&gt; 26 chose_plan      amce         Tax rate for &gt;$375,000    &gt;375k: 45%
#&gt; 27 chose_plan      amce         Tax rate for &gt;$375,000    &gt;375k: 55%
#&gt; 28 chose_plan      amce                    Tax revenue          &lt;75%
#&gt; 29 chose_plan      amce                    Tax revenue        75-95%
#&gt; 30 chose_plan      amce                    Tax revenue       95-105%
#&gt; 31 chose_plan      amce                    Tax revenue      105-125%
#&gt; 32 chose_plan      amce                    Tax revenue         &gt;125%
#&gt;         estimate   std.error            z            p        lower
#&gt; 1   0.0000000000          NA           NA           NA           NA
#&gt; 2  -0.0139987267 0.008367718  -1.67294431 9.433826e-02 -0.030399153
#&gt; 3  -0.0897702241 0.009883554  -9.08278760 1.058290e-19 -0.109141634
#&gt; 4  -0.2215066470 0.012497932 -17.72346405 2.763584e-70 -0.246002143
#&gt; 5   0.0000000000          NA           NA           NA           NA
#&gt; 6  -0.0161677383 0.010015769  -1.61422834 1.064779e-01 -0.035798285
#&gt; 7  -0.0849079259 0.015824370  -5.36564325 8.066123e-08 -0.115923122
#&gt; 8  -0.1868125806 0.021074682  -8.86431331 7.697701e-19 -0.228118198
#&gt; 9   0.0000000000          NA           NA           NA           NA
#&gt; 10  0.0005356495 0.008242105   0.06498941 9.481824e-01 -0.015618579
#&gt; 11 -0.0533364485 0.009713809  -5.49078620 4.001485e-08 -0.072375164
#&gt; 12 -0.1083416179 0.011917151  -9.09123502 9.792035e-20 -0.131698804
#&gt; 13  0.0000000000          NA           NA           NA           NA
#&gt; 14  0.0194226595 0.007719126   2.51617354 1.186368e-02  0.004293451
#&gt; 15  0.0108897506 0.008078966   1.34791393 1.776861e-01 -0.004944732
#&gt; 16 -0.0015463277 0.008431674  -0.18339509 8.544880e-01 -0.018072106
#&gt; 17  0.0000000000          NA           NA           NA           NA
#&gt; 18  0.0384042184 0.008581007   4.47549088 7.623595e-06  0.021585754
#&gt; 19  0.0504838117 0.008867028   5.69343070 1.245118e-08  0.033104755
#&gt; 20  0.0716090284 0.009162901   7.81510419 5.491758e-15  0.053650072
#&gt; 21  0.0441842455 0.009601062   4.60201624 4.184206e-06  0.025366509
#&gt; 22  0.0000000000          NA           NA           NA           NA
#&gt; 23  0.0729290882 0.009630408   7.57279301 3.652841e-14  0.054053835
#&gt; 24  0.1023481041 0.010525057   9.72423245 2.376912e-22  0.081719371
#&gt; 25  0.1342706760 0.011342675  11.83765516 2.493265e-32  0.112039441
#&gt; 26  0.1456934759 0.012358893  11.78855405 4.471520e-32  0.121470491
#&gt; 27  0.1190155301 0.013344593   8.91863335 4.720775e-19  0.092860609
#&gt; 28  0.0000000000          NA           NA           NA           NA
#&gt; 29  0.0155562019 0.011532459   1.34890584 1.773672e-01 -0.007047003
#&gt; 30  0.0433356897 0.016694623   2.59578726 9.437448e-03  0.010614830
#&gt; 31  0.0613870891 0.020195352   3.03966418 2.368421e-03  0.021804926
#&gt; 32  0.0866358183 0.027742084   3.12290235 1.790772e-03  0.032262333
#&gt;           upper
#&gt; 1            NA
#&gt; 2   0.002401700
#&gt; 3  -0.070398814
#&gt; 4  -0.197011151
#&gt; 5            NA
#&gt; 6   0.003462808
#&gt; 7  -0.053892730
#&gt; 8  -0.145506964
#&gt; 9            NA
#&gt; 10  0.016689878
#&gt; 11 -0.034297733
#&gt; 12 -0.084984432
#&gt; 13           NA
#&gt; 14  0.034551868
#&gt; 15  0.026724233
#&gt; 16  0.014979450
#&gt; 17           NA
#&gt; 18  0.055222683
#&gt; 19  0.067862868
#&gt; 20  0.089567985
#&gt; 21  0.063001982
#&gt; 22           NA
#&gt; 23  0.091804341
#&gt; 24  0.122976837
#&gt; 25  0.156501911
#&gt; 26  0.169916461
#&gt; 27  0.145170451
#&gt; 28           NA
#&gt; 29  0.038159407
#&gt; 30  0.076056550
#&gt; 31  0.100969252
#&gt; 32  0.141009303</div><div class='input'>
</div># NOT RUN {
data("immigration")
# estimating AMCEs with constraints
amce(immigration, ChosenImmigrant ~ Gender + ReasonForApplication * CountryOfOrigin,
     id = ~CaseID, constraints = list(~ReasonForApplication + CountryOfOrigin))

# balance testing example
plot(amce(immigration[!is.na(immigration$ethnocentrism),
     ethnocentrism ~ Gender + Education + LanguageSkills, id = ~ CaseID))

# reference category sensitivity
x <- amce_by_reference(immigration, ChosenImmigrant ~ LanguageSkills + Education, 
       variable = ~ LanguageSkills, id = ~ CaseID)
# plot
plot(x, group = "BY")
# }
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Thomas J. Leeper.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

